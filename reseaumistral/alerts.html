<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alertes Transport</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
/* =====================================================
   Intégration du style Liquid Glass par BecabDev
   ===================================================== */
:root {
    --glass-bg-light: rgba(255, 255, 255, 0.72);
    --glass-bg-light-strong: rgba(255, 255, 255, 0.88);
    --glass-bg-dark: rgba(28, 28, 30, 0.78);
    --glass-bg-dark-strong: rgba(28, 28, 30, 0.9);
    
    --glass-blur-mobile: blur(20px);
    --glass-blur-tablet: blur(32px);
    --glass-blur-strong: blur(40px);
    
    --glass-border-light: rgba(255, 255, 255, 0.18);
    --glass-border-dark: rgba(0, 0, 0, 0.08);
    --glass-border-highlight: rgba(255, 255, 255, 0.35);
    
    --glass-shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.08), 
                          0 2px 8px rgba(0, 0, 0, 0.04),
                          inset 0 1px 0 rgba(255, 255, 255, 0.3);
    --glass-shadow-hover: 0 12px 48px rgba(0, 0, 0, 0.12), 
                           0 4px 12px rgba(0, 0, 0, 0.08),
                           inset 0 1px 0 rgba(255, 255, 255, 0.4);
    --glass-shadow-pressed: 0 4px 16px rgba(0, 0, 0, 0.08),
                             inset 0 2px 6px rgba(0, 0, 0, 0.1);
    
    --accent-blue: #007AFF;
    --accent-blue-glow: rgba(0, 122, 255, 0.3);
    --accent-red: #FF3B30;
    --accent-orange: #FF9500;
    --accent-yellow: #FFCC00;
    --accent-green: #34C759;
    --accent-gray: #8E8E93;
    
    --text-primary: rgba(0, 0, 0, 0.92);
    --text-secondary: rgba(0, 0, 0, 0.68);
    --text-tertiary: rgba(0, 0, 0, 0.48);
    
    --bg-gradient-start: rgba(0, 122, 255, 0.08);
    --bg-gradient-mid: rgba(168, 85, 247, 0.05);
    --bg-gradient-end: rgba(255, 149, 0, 0.06);
    
    --spacing-xs: 8px;
    --spacing-sm: 12px;
    --spacing-md: 16px;
    --spacing-lg: 24px;
    --spacing-xl: 32px;
    
    --radius-sm: 12px;
    --radius-md: 16px;
    --radius-lg: 36px;
    --radius-xl: 24px;
    --radius-pill: 50px;
    
    --transition-smooth: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    --transition-standard: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

@media (prefers-color-scheme: dark) {
    :root {
        --glass-bg-light: rgba(44, 44, 46, 0.82);
        --glass-bg-light-strong: rgba(44, 44, 46, 0.95);
        --glass-bg-dark: rgba(28, 28, 30, 0.88);
        --glass-bg-dark-strong: rgba(28, 28, 30, 0.96);
        
        --glass-border-light: rgba(255, 255, 255, 0.15);
        --glass-border-dark: rgba(255, 255, 255, 0.08);
        --glass-border-highlight: rgba(255, 255, 255, 0.25);
        
        --glass-shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.4), 
                              0 2px 8px rgba(0, 0, 0, 0.3),
                              inset 0 1px 0 rgba(255, 255, 255, 0.1);
        --glass-shadow-hover: 0 12px 48px rgba(0, 0, 0, 0.5), 
                               0 4px 12px rgba(0, 0, 0, 0.35),
                               inset 0 1px 0 rgba(255, 255, 255, 0.15);
        --glass-shadow-pressed: 0 4px 16px rgba(0, 0, 0, 0.5),
                                 inset 0 2px 6px rgba(0, 0, 0, 0.4);
        
        --text-primary: rgba(255, 255, 255, 0.95);
        --text-secondary: rgba(255, 255, 255, 0.72);
        --text-tertiary: rgba(255, 255, 255, 0.52);
        
        --accent-blue: #0A84FF;
        --accent-blue-glow: rgba(10, 132, 255, 0.4);
        --accent-red: #FF453A;
        --accent-orange: #FF9F0A;
        --accent-yellow: #FFD60A;
        --accent-green: #32D74B;
        
        --bg-gradient-start: rgba(10, 132, 255, 0.12);
        --bg-gradient-mid: rgba(167, 139, 250, 0.08);
        --bg-gradient-end: rgba(255, 159, 10, 0.1);
    }
}

/* =====================================================
   RESET ET BASE
   ===================================================== */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, 
        var(--bg-gradient-start) 0%, 
        var(--bg-gradient-mid) 50%,
        var(--bg-gradient-end) 100%);
    background-attachment: fixed;
    color: var(--text-primary);
    line-height: 1.5;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    min-height: 100vh;
}

@media (prefers-color-scheme: dark) {
    body {
        background: linear-gradient(135deg, 
            #000000 0%,
            #0a0a0c 50%,
            #000000 100%);
        background-attachment: fixed;
    }
    
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at 20% 30%, var(--bg-gradient-start) 0%, transparent 50%),
                    radial-gradient(circle at 80% 70%, var(--bg-gradient-end) 0%, transparent 50%),
                    radial-gradient(circle at 50% 50%, var(--bg-gradient-mid) 0%, transparent 50%);
        pointer-events: none;
        z-index: 0;
    }
}

.gpu-accelerated {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
}

/* =====================================================
   HEADER FLOTTANT (Liquid Glass)
   ===================================================== */
.header {
    position: sticky;
    top: var(--spacing-md);
    z-index: 1000;
    margin: var(--spacing-md);
    animation: slideDown 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-40px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.header-glass {
    background: var(--glass-bg-light);
    backdrop-filter: var(--glass-blur-mobile) saturate(180%);
    -webkit-backdrop-filter: var(--glass-blur-mobile) saturate(180%);
    border: 1px solid var(--glass-border-light);
    border-radius: var(--radius-xl);
    padding: var(--spacing-lg);
    box-shadow: var(--glass-shadow-soft);
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    transition: var(--transition-standard);
}

@media (prefers-color-scheme: dark) {
    .header-glass {
        background: var(--glass-bg-dark);
        border-color: rgba(255, 255, 255, 0.15);
    }
}

.header.scrolled .header-glass {
    background: var(--glass-bg-light-strong);
    backdrop-filter: var(--glass-blur-strong) saturate(200%);
    -webkit-backdrop-filter: var(--glass-blur-strong) saturate(200%);
    box-shadow: var(--glass-shadow-hover);
}

@media (prefers-color-scheme: dark) {
    .header.scrolled .header-glass {
        background: var(--glass-bg-dark-strong);
    }
}

.header-icon {
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, var(--accent-blue) 0%, #0051D5 100%);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 28px;
    box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
    flex-shrink: 0;
    transition: var(--transition-smooth);
}

@media (prefers-color-scheme: dark) {
    .header-icon {
        background: linear-gradient(135deg, var(--accent-blue) 0%, #0066E5 100%);
        box-shadow: 0 8px 24px var(--accent-blue-glow),
                    inset 0 1px 0 rgba(255, 255, 255, 0.25);
    }
}

.header-icon:active {
    transform: scale(0.92);
}

.header-text {
    flex: 1;
    min-width: 0;
}

.header-text h1 {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 2px;
    letter-spacing: -0.5px;
}

.header-text p {
    font-size: 14px;
    color: var(--text-secondary);
    font-weight: 500;
}

/* =====================================================
   CONTENEUR PRINCIPAL
   ===================================================== */
.main-container {
    padding: 0 var(--spacing-md) var(--spacing-xl);
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
}

/* =====================================================
   SECTION RECHERCHE ET FILTRES (Liquid Glass)
   ===================================================== */
.controls-section {
    margin-bottom: var(--spacing-lg);
    animation: fadeInUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) 0.1s backwards;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.search-glass {
    background: var(--glass-bg-light);
    backdrop-filter: var(--glass-blur-mobile) saturate(180%);
    -webkit-backdrop-filter: var(--glass-blur-mobile) saturate(180%);
    border: 1px solid var(--glass-border-light);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
    box-shadow: var(--glass-shadow-soft);
    margin-bottom: var(--spacing-md);
    transition: var(--transition-standard);
    margin-top: 18px;
}

@media (prefers-color-scheme: dark) {
    .search-glass {
        background: var(--glass-bg-dark);
        border-color: rgba(255, 255, 255, 0.15);
    }
}

.search-container {
    position: relative;
}

.search-input {
    width: 100%;
    height: 52px;
    padding: 0 var(--spacing-md) 0 52px;
    border: 2px solid transparent;
    border-radius: var(--radius-sm);
    background: rgba(255, 255, 255, 0.5);
    font-size: 17px;
    font-weight: 500;
    color: var(--text-primary);
    transition: var(--transition-standard);
    outline: none;
}

@media (prefers-color-scheme: dark) {
    .search-input {
        background: rgba(255, 255, 255, 0.12);
        color-scheme: dark;
    }
}

.search-input:focus {
    background: rgba(255, 255, 255, 0.8);
    border-color: var(--accent-blue);
    box-shadow: 0 0 0 4px var(--accent-blue-glow);
    transform: scale(1.01);
}

@media (prefers-color-scheme: dark) {
    .search-input:focus {
        background: rgba(255, 255, 255, 0.18);
    }
}

.search-input::placeholder {
    color: var(--text-tertiary);
}

.search-icon {
    position: absolute;
    left: var(--spacing-md);
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-tertiary);
    font-size: 18px;
    pointer-events: none;
    transition: var(--transition-fast);
}

.search-input:focus ~ .search-icon {
    color: var(--accent-blue);
    transform: translateY(-50%) scale(1.1);
}

/* Filtres en chips Liquid Glass */
.filters-glass {
    background: var(--glass-bg-light);
    backdrop-filter: var(--glass-blur-mobile) saturate(180%);
    -webkit-backdrop-filter: var(--glass-blur-mobile) saturate(180%);
    border: 1px solid var(--glass-border-light);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
    box-shadow: var(--glass-shadow-soft);
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
}

.filters-glass::-webkit-scrollbar {
    display: none;
}

@media (prefers-color-scheme: dark) {
    .filters-glass {
        background: var(--glass-bg-dark);
        border-color: rgba(255, 255, 255, 0.15);
    }
}

.filter-chips {
    display: flex;
    gap: var(--spacing-xs);
    padding-bottom: 2px;
}

.filter-chip {
    padding: 10px 18px;
    border-radius: var(--radius-pill);
    border: 1.5px solid rgba(255, 255, 255, 0.25);
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.4) 0%, 
        rgba(255, 255, 255, 0.25) 100%);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    color: var(--text-primary);
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-smooth);
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
}

@media (prefers-color-scheme: dark) {
    .filter-chip {
        background: linear-gradient(135deg, 
            rgba(255, 255, 255, 0.18) 0%, 
            rgba(255, 255, 255, 0.1) 100%);
        border-color: rgba(255, 255, 255, 0.2);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15);
    }
}

.filter-chip:active {
    transform: scale(0.94);
}

.filter-chip.active {
    background: linear-gradient(135deg, var(--accent-blue) 0%, #0051D5 100%);
    color: white;
    border-color: transparent;
    box-shadow: 0 6px 20px rgba(0, 122, 255, 0.35),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
    transform: scale(1.05);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

@media (prefers-color-scheme: dark) {
    .filter-chip.active {
        background: linear-gradient(135deg, var(--accent-blue) 0%, #0066E5 100%);
        box-shadow: 0 6px 20px var(--accent-blue-glow),
                    inset 0 1px 0 rgba(255, 255, 255, 0.25);
    }
}

.filter-chip i {
    font-size: 14px;
}

/* =====================================================
   BOUTON ACTUALISER (Flottant sur mobile)
   ===================================================== */
.refresh-fab {
    position: fixed;
    bottom: var(--spacing-lg);
    left: var(--spacing-lg);
    width: 64px;
    height: 64px;
    border: none;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent-blue) 0%, #0051D5 100%);
    box-shadow: 0 12px 40px rgba(0, 122, 255, 0.4),
                0 4px 12px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
    color: white;
    font-size: 24px;
    cursor: pointer;
    transition: var(--transition-smooth);
    z-index: 999;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fabPulse 2s ease-in-out infinite;
}

@media (prefers-color-scheme: dark) {
    .refresh-fab {
        background: linear-gradient(135deg, var(--accent-blue) 0%, #0066E5 100%);
        box-shadow: 0 12px 40px var(--accent-blue-glow),
                    0 4px 12px rgba(0, 0, 0, 0.4),
                    inset 0 1px 0 rgba(255, 255, 255, 0.25);
    }
}

@keyframes fabPulse {
    0%, 100% {
        box-shadow: 0 12px 40px rgba(0, 122, 255, 0.4),
                    0 4px 12px rgba(0, 0, 0, 0.15),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }
    50% {
        box-shadow: 0 16px 56px rgba(0, 122, 255, 0.5),
                    0 6px 16px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }
}

@media (prefers-color-scheme: dark) {
    @keyframes fabPulse {
        0%, 100% {
            box-shadow: 0 12px 40px var(--accent-blue-glow),
                        0 4px 12px rgba(0, 0, 0, 0.4),
                        inset 0 1px 0 rgba(255, 255, 255, 0.25);
        }
        50% {
            box-shadow: 0 16px 56px rgba(10, 132, 255, 0.6),
                        0 6px 16px rgba(0, 0, 0, 0.5),
                        inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
    }
}

.refresh-fab:active {
    transform: scale(0.88);
    box-shadow: 0 6px 20px rgba(0, 122, 255, 0.3),
                inset 0 3px 8px rgba(0, 0, 0, 0.2);
}

.refresh-fab.spinning {
    animation: spinRefresh 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes spinRefresh {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}

/* =====================================================
   CARTES D'ALERTES (Liquid Glass)
   ===================================================== */
.alerts-section {
    display: grid;
    gap: var(--spacing-md);
}

.alert-card {
    background: var(--glass-bg-light);
    backdrop-filter: var(--glass-blur-mobile) saturate(180%);
    -webkit-backdrop-filter: var(--glass-blur-mobile) saturate(180%);
    border: 1px solid var(--glass-border-light);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--glass-shadow-soft);
    transition: var(--transition-smooth);
    opacity: 0;
    transform: translateY(30px) scale(0.95);
    animation: cardAppear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    position: relative;
}

@media (prefers-color-scheme: dark) {
    .alert-card {
        background: var(--glass-bg-dark);
        border-color: rgba(255, 255, 255, 0.15);
    }
}

@keyframes cardAppear {
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.alert-card:active {
    transform: scale(0.97);
    box-shadow: var(--glass-shadow-pressed);
}

/* Effet de lumière speculaire */
.alert-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 50%;
    background: linear-gradient(to bottom,
        rgba(255, 255, 255, 0.15) 0%,
        rgba(255, 255, 255, 0.05) 50%,
        rgba(255, 255, 255, 0) 100%);
    pointer-events: none;
    opacity: 0;
    transition: var(--transition-standard);
}

@media (prefers-color-scheme: dark) {
    .alert-card::before {
        background: linear-gradient(to bottom,
            rgba(255, 255, 255, 0.08) 0%,
            rgba(255, 255, 255, 0.03) 50%,
            rgba(255, 255, 255, 0) 100%);
    }
}

.alert-card:active::before {
    opacity: 1;
}

.alert-header {
    padding: var(--spacing-lg);
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-md);
    border-bottom: 1px solid rgba(0, 0, 0, 0.06);
}

@media (prefers-color-scheme: dark) {
    .alert-header {
        border-bottom-color: rgba(255, 255, 255, 0.1);
    }
}

.alert-icon {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    color: white;
    flex-shrink: 0;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
    transition: var(--transition-smooth);
}

@media (prefers-color-scheme: dark) {
    .alert-icon {
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
}

.alert-card:active .alert-icon {
    transform: scale(0.9);
}

.alert-details {
    flex: 1;
    min-width: 0;
}

.alert-type {
    display: inline-flex;
    align-items: center;
    padding: 6px 14px;
    border-radius: var(--radius-pill);
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: var(--spacing-xs);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}

.alert-title {
    font-size: 18px;
    font-weight: 700;
    line-height: 1.3;
    margin-bottom: 6px;
    letter-spacing: -0.3px;
}

.alert-timestamp {
    font-size: 13px;
    color: var(--text-secondary);
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 6px;
}

.alert-content {
    padding: var(--spacing-md) var(--spacing-lg) var(--spacing-lg);
}

.alert-description {
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: var(--spacing-md);
    font-weight: 500;
}

.alert-metadata {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}

.alert-metadata-item {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-sm);
    font-size: 14px;
    color: var(--text-secondary);
    font-weight: 500;
    padding: var(--spacing-xs) var(--spacing-sm);
    background: rgba(0, 0, 0, 0.03);
    border-radius: var(--spacing-xs);
}

@media (prefers-color-scheme: dark) {
    .alert-metadata-item {
        background: rgba(255, 255, 255, 0.06);
    }
}

.alert-metadata-item i {
    margin-top: 2px;
    flex-shrink: 0;
}

.alert-metadata-item a {
    color: var(--accent-blue);
    text-decoration: none;
    font-weight: 600;
}

/* Couleurs des alertes */
.alert-travaux .alert-icon { 
    background: linear-gradient(135deg, #FF9500 0%, #FF8000 100%); 
}
.alert-travaux .alert-type { 
    background: rgba(255, 149, 0, 0.15); 
    color: #FF8000; 
}

@media (prefers-color-scheme: dark) {
    .alert-travaux .alert-icon {
        background: linear-gradient(135deg, var(--accent-orange) 0%, #FF8000 100%);
    }
    .alert-travaux .alert-type {
        background: rgba(255, 159, 10, 0.2);
        color: var(--accent-orange);
    }
}

.alert-accident .alert-icon { 
    background: linear-gradient(135deg, #FF3B30 0%, #E01E1E 100%); 
}
.alert-accident .alert-type { 
    background: rgba(255, 59, 48, 0.15); 
    color: #E01E1E; 
}

@media (prefers-color-scheme: dark) {
    .alert-accident .alert-icon {
        background: linear-gradient(135deg, var(--accent-red) 0%, #E01E1E 100%);
    }
    .alert-accident .alert-type {
        background: rgba(255, 69, 58, 0.2);
        color: var(--accent-red);
    }
}

.alert-meteo .alert-icon { 
    background: linear-gradient(135deg, #8E8E93 0%, #636366 100%); 
}
.alert-meteo .alert-type { 
    background: rgba(142, 142, 147, 0.15); 
    color: #636366; 
}

@media (prefers-color-scheme: dark) {
    .alert-meteo .alert-icon {
        background: linear-gradient(135deg, #98989D 0%, #7C7C80 100%);
    }
    .alert-meteo .alert-type {
        background: rgba(152, 152, 157, 0.2);
        color: #98989D;
    }
}

.alert-panne .alert-icon { 
    background: linear-gradient(135deg, #FF3B30 0%, #E01E1E 100%); 
}
.alert-panne .alert-type { 
    background: rgba(255, 59, 48, 0.15); 
    color: #E01E1E; 
}

@media (prefers-color-scheme: dark) {
    .alert-panne .alert-icon {
        background: linear-gradient(135deg, var(--accent-red) 0%, #E01E1E 100%);
    }
    .alert-panne .alert-type {
        background: rgba(255, 69, 58, 0.2);
        color: var(--accent-red);
    }
}

.alert-manifestation .alert-icon { 
    background: linear-gradient(135deg, #FF9500 0%, #FF8000 100%); 
}
.alert-manifestation .alert-type { 
    background: rgba(255, 149, 0, 0.15); 
    color: #FF8000; 
}

@media (prefers-color-scheme: dark) {
    .alert-manifestation .alert-icon {
        background: linear-gradient(135deg, var(--accent-orange) 0%, #FF8000 100%);
    }
    .alert-manifestation .alert-type {
        background: rgba(255, 159, 10, 0.2);
        color: var(--accent-orange);
    }
}

.alert-service-reduit .alert-icon { 
    background: linear-gradient(135deg, #FF9500 0%, #FF8000 100%); 
}
.alert-service-reduit .alert-type { 
    background: rgba(255, 149, 0, 0.15); 
    color: #FF8000; 
}

@media (prefers-color-scheme: dark) {
    .alert-service-reduit .alert-icon {
        background: linear-gradient(135deg, var(--accent-orange) 0%, #FF8000 100%);
    }
    .alert-service-reduit .alert-type {
        background: rgba(255, 159, 10, 0.2);
        color: var(--accent-orange);
    }
}

.alert-service-modifie .alert-icon { 
    background: linear-gradient(135deg, #FFCC00 0%, #FFB800 100%); 
}
.alert-service-modifie .alert-type { 
    background: rgba(255, 204, 0, 0.15); 
    color: #CC9900; 
}

@media (prefers-color-scheme: dark) {
    .alert-service-modifie .alert-icon {
        background: linear-gradient(135deg, var(--accent-yellow) 0%, #FFB800 100%);
    }
    .alert-service-modifie .alert-type {
        background: rgba(255, 214, 10, 0.2);
        color: var(--accent-yellow);
    }
}

.alert-information .alert-icon { 
    background: linear-gradient(135deg, var(--accent-blue) 0%, #0051D5 100%); 
}
.alert-information .alert-type { 
    background: rgba(0, 122, 255, 0.15); 
    color: var(--accent-blue); 
}

@media (prefers-color-scheme: dark) {
    .alert-information .alert-icon {
        background: linear-gradient(135deg, var(--accent-blue) 0%, #0066E5 100%);
    }
    .alert-information .alert-type {
        background: rgba(10, 132, 255, 0.2);
        color: var(--accent-blue);
    }
}

/* =====================================================
   ÉTATS : CHARGEMENT, VIDE, ERREUR
   ===================================================== */
.state-container {
    background: var(--glass-bg-light);
    backdrop-filter: var(--glass-blur-mobile) saturate(180%);
    -webkit-backdrop-filter: var(--glass-blur-mobile) saturate(180%);
    border: 1px solid var(--glass-border-light);
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl) var(--spacing-lg);
    box-shadow: var(--glass-shadow-soft);
    text-align: center;
    animation: fadeInUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@media (prefers-color-scheme: dark) {
    .state-container {
        background: var(--glass-bg-dark);
        border-color: rgba(255, 255, 255, 0.15);
    }
}

.loading-spinner {
    width: 48px;
    height: 48px;
    border: 4px solid rgba(0, 122, 255, 0.2);
    border-top-color: var(--accent-blue);
    border-radius: 50%;
    animation: spin 1s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
    margin: 0 auto var(--spacing-md);
}

@media (prefers-color-scheme: dark) {
    .loading-spinner {
        border-color: rgba(10, 132, 255, 0.3);
        border-top-color: var(--accent-blue);
    }
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.state-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto var(--spacing-md);
    background: linear-gradient(135deg, 
        rgba(0, 122, 255, 0.12) 0%, 
        rgba(168, 85, 247, 0.08) 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    color: var(--accent-blue);
}

@media (prefers-color-scheme: dark) {
    .state-icon {
        background: linear-gradient(135deg, 
            rgba(10, 132, 255, 0.18) 0%, 
            rgba(167, 139, 250, 0.12) 100%);
    }
}

.state-title {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: var(--spacing-xs);
    letter-spacing: -0.3px;
}

.state-description {
    color: var(--text-secondary);
    font-size: 15px;
    font-weight: 500;
    line-height: 1.5;
}

.retry-button {
    margin-top: var(--spacing-md);
    padding: 12px 28px;
    border: none;
    border-radius: var(--radius-sm);
    background: linear-gradient(135deg, var(--accent-blue) 0%, #0051D5 100%);
    color: white;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 6px 20px rgba(0, 122, 255, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
    transition: var(--transition-smooth);
}

@media (prefers-color-scheme: dark) {
    .retry-button {
        background: linear-gradient(135deg, var(--accent-blue) 0%, #0066E5 100%);
        box-shadow: 0 6px 20px var(--accent-blue-glow),
                    inset 0 1px 0 rgba(255, 255, 255, 0.25);
    }
}

.retry-button:active {
    transform: scale(0.94);
    box-shadow: var(--glass-shadow-pressed);
}

/* =====================================================
   INFO MISE À JOUR
   ===================================================== */
.update-info {
    background: var(--glass-bg-light);
    backdrop-filter: var(--glass-blur-mobile) saturate(180%);
    -webkit-backdrop-filter: var(--glass-blur-mobile) saturate(180%);
    border: 1px solid var(--glass-border-light);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-top: var(--spacing-lg);
    box-shadow: var(--glass-shadow-soft);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-xs);
    font-size: 14px;
    color: var(--text-secondary);
    font-weight: 500;
    animation: fadeInUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) 0.3s backwards;
}

@media (prefers-color-scheme: dark) {
    .update-info {
        background: var(--glass-bg-dark);
        border-color: rgba(255, 255, 255, 0.15);
    }
}

/* =====================================================
   BOUTON RETOUR EN HAUT
   ===================================================== */
.back-to-top {
    position: fixed;
    bottom: calc(var(--spacing-lg) + 80px);
    right: var(--spacing-lg);
    width: 52px;
    height: 52px;
    border: none;
    border-radius: 50%;
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.85) 0%, 
        rgba(255, 255, 255, 0.7) 100%);
    backdrop-filter: var(--glass-blur-mobile);
    -webkit-backdrop-filter: var(--glass-blur-mobile);
    border: 1px solid var(--glass-border-light);
    color: var(--accent-blue);
    font-size: 20px;
    cursor: pointer;
    box-shadow: var(--glass-shadow-soft);
    opacity: 0;
    transform: scale(0.7);
    transition: var(--transition-smooth);
    z-index: 998;
    pointer-events: none;
}

@media (prefers-color-scheme: dark) {
    .back-to-top {
        background: linear-gradient(135deg, 
            rgba(255, 255, 255, 0.2) 0%, 
            rgba(255, 255, 255, 0.12) 100%);
        border-color: rgba(255, 255, 255, 0.2);
    }
}

.back-to-top.visible {
    opacity: 1;
    transform: scale(1);
    pointer-events: auto;
}

.back-to-top:active {
    transform: scale(0.88);
    box-shadow: var(--glass-shadow-pressed);
}

/* =====================================================
   RESPONSIVE - TABLET
   ===================================================== */
@media (min-width: 769px) and (max-width: 1024px) {
    :root {
        --glass-blur-mobile: var(--glass-blur-tablet);
    }

    .header {
        top: var(--spacing-lg);
        margin: var(--spacing-lg) var(--spacing-lg) 0;
    }

    .header-glass {
        padding: var(--spacing-xl);
    }

    .filter-chips {
        flex-wrap: wrap;
    }

    .alerts-section {
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    }
}

/* =====================================================
   RESPONSIVE - DESKTOP
   ===================================================== */
@media (min-width: 1025px) {
    :root {
        --glass-blur-mobile: blur(48px);
    }

    .header {
        top: var(--spacing-xl);
        margin: var(--spacing-xl) var(--spacing-xl) 0;
    }

    .header-glass {
        padding: var(--spacing-xl);
    }

    .search-glass,
    .filters-glass {
        padding: var(--spacing-lg);
    }

    .filter-chips {
        flex-wrap: wrap;
    }

    .alerts-section {
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    }

    .refresh-fab {
        width: 72px;
        height: 72px;
        font-size: 28px;
    }

    .back-to-top {
        bottom: calc(var(--spacing-xl) + 88px);
        right: var(--spacing-xl);
        width: 60px;
        height: 60px;
    }

    .alert-card:hover {
        transform: translateY(-4px) scale(1.01);
        box-shadow: var(--glass-shadow-hover);
    }

    .filter-chip:hover {
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1),
                    inset 0 1px 0 rgba(255, 255, 255, 0.5);
    }

    @media (prefers-color-scheme: dark) {
        .filter-chip:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4),
                        inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
    }

    .refresh-fab:hover {
        transform: scale(1.08);
        box-shadow: 0 16px 56px rgba(0, 122, 255, 0.5),
                    0 6px 16px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }

    @media (prefers-color-scheme: dark) {
        .refresh-fab:hover {
            box-shadow: 0 16px 56px rgba(10, 132, 255, 0.6),
                        0 6px 16px rgba(0, 0, 0, 0.5),
                        inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
    }

    .back-to-top:hover {
        transform: scale(1.1);
        box-shadow: var(--glass-shadow-hover);
    }
}

/* =====================================================
   ACCESSIBILITE
   ===================================================== */
@media (prefers-reduced-transparency: reduce) {
    .header-glass,
    .search-glass,
    .filters-glass,
    .alert-card,
    .state-container,
    .update-info,
    .back-to-top {
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
        background: rgba(255, 255, 255, 0.98);
    }

    @media (prefers-color-scheme: dark) {
        .header-glass,
        .search-glass,
        .filters-glass,
        .alert-card,
        .state-container,
        .update-info,
        .back-to-top {
            background: rgba(28, 28, 30, 0.98);
        }
    }
}

@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
    }
}

/* =====================================================
   UTILITAIRES
   ===================================================== */
.hidden {
    display: none;
}
    </style>
</head>
<body>

    <main class="main-container">
        <section class="controls-section">
            <div class="search-glass gpu-accelerated">
                <div class="search-container">
                    <input type="text" id="search-input" class="search-input" placeholder="Rechercher une alerte...">
                    <i class="fas fa-search search-icon"></i>
                </div>
            </div>
            
            <div class="filters-glass gpu-accelerated">
                <div class="filter-chips">
                    <button class="filter-chip active" data-effect="all">
                        <i class="fas fa-list"></i>
                        Toutes
                    </button>
                    <button class="filter-chip" data-effect="1">
                        <i class="fas fa-hard-hat"></i>
                        Travaux
                    </button>
                    <button class="filter-chip" data-effect="6">
                        <i class="fas fa-ambulance"></i>
                        Accidents
                    </button>
                    <button class="filter-chip" data-effect="3">
                        <i class="fas fa-cloud-rain"></i>
                        Météo
                    </button>
                    <button class="filter-chip" data-effect="7">
                        <i class="fas fa-cogs"></i>
                        Pannes
                    </button>
                    <button class="filter-chip" data-effect="4">
                        <i class="fas fa-arrow-down"></i>
                        Service réduit
                    </button>
                </div>
            </div>
        </section>

        <section class="alerts-section" id="alerts-container">
            <div class="state-container">
                <div class="loading-spinner"></div>
                <div class="state-title">Chargement</div>
                <div class="state-description">Récupération des alertes en cours...</div>
            </div>
        </section>
    </main>

    <button class="refresh-fab gpu-accelerated" id="refresh-button">
        <i class="fas fa-sync-alt"></i>
    </button>

    <button class="back-to-top gpu-accelerated" id="back-to-top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/protobufjs/6.11.3/protobuf.min.js"></script>
    <script>
        let currentAlerts = [];
        let currentFilter = 'all';
        let refreshTimer = null;

        document.addEventListener('DOMContentLoaded', () => {
            fetchServiceAlerts();
            initEventListeners();
            initBackToTop();
            initScrollEffects();
        });

        const GTFS_EFFECTS = {
            NO_SERVICE: 1,
            REDUCED_SERVICE: 2,
            SIGNIFICANT_DELAYS: 3,
            DETOUR: 4,
            ADDITIONAL_SERVICE: 5,
            MODIFIED_SERVICE: 6,
            OTHER_EFFECT: 7,
            UNKNOWN_EFFECT: 8,
            STOP_MOVED: 9,
            NO_EFFECT: 10,
            ACCESSIBILITY_ISSUE: 11
        };

        const GTFS_CAUSES = {
            UNKNOWN_CAUSE: 1,
            OTHER_CAUSE: 2,
            TECHNICAL_PROBLEM: 3,
            STRIKE: 4,
            DEMONSTRATION: 5,
            ACCIDENT: 6,
            HOLIDAY: 7,
            WEATHER: 8,
            MAINTENANCE: 9,
            CONSTRUCTION: 10,
            POLICE_ACTIVITY: 11,
            MEDICAL_EMERGENCY: 12
        };

        async function decodeProtobuf(buffer) {
            try {
                const root = await protobuf.load('gtfs-realtime.proto');
                const FeedMessage = root.lookupType('transit_realtime.FeedMessage');
                const message = FeedMessage.decode(new Uint8Array(buffer));
                return FeedMessage.toObject(message, { 
                    longs: String, 
                    enums: String, 
                    defaults: true 
                });
            } catch (error) {
                throw error;
            }
        }

        async function fetchServiceAlerts() {
            try {
                showLoading();
                
                const response = await fetch('proxy-cors/proxy_servicealerts.php');
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                
                const buffer = await response.arrayBuffer();
                const data = await decodeProtobuf(buffer);

                const activeAlerts = [];

                if (Array.isArray(data.entity) && data.entity.length > 0) {
                    data.entity.forEach(entity => {
                        try {
                            const alert = entity.alert;
                            if (alert && isAlertActive(alert)) {
                                const processedAlert = processAlert(entity, alert);
                                if (processedAlert) {
                                    activeAlerts.push(processedAlert);
                                }
                            }
                        } catch (error) {
                            console.warn('Erreur lors du traitement d\'une alerte:', error, entity);
                        }
                    });
                }

                currentAlerts = sortAlertsByPriority(activeAlerts);
                displayAlerts(currentAlerts);
                
            } catch (error) {
                showError(error.message);
            }
        }

        function isAlertActive(alert) {
            const now = Date.now() / 1000; 
            
            if (!alert.activePeriod || alert.activePeriod.length === 0) {
                return true;
            }
            
            return alert.activePeriod.some(period => {
                const start = period.start ? parseInt(period.start) : 0;
                const end = period.end ? parseInt(period.end) : Number.MAX_SAFE_INTEGER;
                return now >= start && now <= end;
            });
        }

        function processAlert(entity, alert) {
            const headerText = getLocalizedText(alert.headerText);
            const descriptionText = getLocalizedText(alert.descriptionText);
            const urlText = getLocalizedText(alert.url);
            
            if (!headerText) {
                return null;
            }
            
            const activePeriods = processActivePeriods(alert.activePeriod);
            const affectedEntities = processAffectedEntities(alert.informedEntity);

            return {
                id: entity.id || generateId(),
                header: headerText,
                description: descriptionText || '',
                url: urlText || '',
                effect: normalizeEffect(alert.effect),
                cause: normalizeCause(alert.cause),
                severity: alert.severityLevel || 'UNKNOWN',
                activePeriods: activePeriods,
                affectedEntities: affectedEntities,
                timestamp: new Date(),
                lastModified: entity.isDeleted ? null : new Date()
            };
        }

        function getLocalizedText(textObj) {
            if (!textObj || !textObj.translation) return '';
            
            const translations = textObj.translation;
            
            const frTranslation = translations.find(t => t.language === 'fr' || t.language === 'fr-FR');
            if (frTranslation && frTranslation.text) {
                return frTranslation.text.trim();
            }
            
            const enTranslation = translations.find(t => t.language === 'en' || t.language === 'en-US');
            if (enTranslation && enTranslation.text) {
                return enTranslation.text.trim();
            }
            
            const firstTranslation = translations.find(t => t.text && t.text.trim());
            return firstTranslation ? firstTranslation.text.trim() : '';
        }

        function processActivePeriods(activePeriods) {
            if (!activePeriods || activePeriods.length === 0) return [];
            
            return activePeriods.map(period => ({
                start: period.start ? new Date(parseInt(period.start) * 1000) : null,
                end: period.end ? new Date(parseInt(period.end) * 1000) : null
            })).filter(period => period.start || period.end);
        }

        function processAffectedEntities(informedEntities) {
            if (!informedEntities || informedEntities.length === 0) return [];
            
            return informedEntities.map(entity => ({
                agencyId: entity.agencyId || null,
                routeId: entity.routeId || null,
                routeType: entity.routeType || null,
                stopId: entity.stopId || null,
                tripId: entity.trip?.tripId || null,
                directionId: entity.trip?.directionId || null
            }));
        }

        function normalizeEffect(effect) {
            if (effect === undefined || effect === null) {
                return 'UNKNOWN_EFFECT';
            }
            
            if (typeof effect === 'string') {
                return effect;
            }
            
            const effectNumber = parseInt(effect);
            const effectMap = {
                1: 'NO_SERVICE',
                2: 'REDUCED_SERVICE', 
                3: 'SIGNIFICANT_DELAYS',
                4: 'DETOUR',
                5: 'ADDITIONAL_SERVICE',
                6: 'MODIFIED_SERVICE',
                7: 'OTHER_EFFECT',
                8: 'UNKNOWN_EFFECT',
                9: 'STOP_MOVED',
                10: 'NO_EFFECT',
                11: 'ACCESSIBILITY_ISSUE'
            };
            
            return effectMap[effectNumber] || 'UNKNOWN_EFFECT';
        }

        function normalizeCause(cause) {
            if (cause === undefined || cause === null) {
                return 'UNKNOWN_CAUSE';
            }
            
            if (typeof cause === 'string') {
                return cause;
            }
            
            const causeNumber = parseInt(cause);
            const causeMap = {
                1: 'UNKNOWN_CAUSE',
                2: 'OTHER_CAUSE',
                3: 'TECHNICAL_PROBLEM',
                4: 'STRIKE',
                5: 'DEMONSTRATION',
                6: 'ACCIDENT',
                7: 'HOLIDAY',
                8: 'WEATHER',
                9: 'MAINTENANCE',
                10: 'CONSTRUCTION',
                11: 'POLICE_ACTIVITY',
                12: 'MEDICAL_EMERGENCY'
            };
            
            return causeMap[causeNumber] || 'UNKNOWN_CAUSE';
        }

        function showLoading() {
            document.getElementById('alerts-container').innerHTML = `
                <div class="state-container">
                    <div class="loading-spinner"></div>
                    <div class="state-title">Chargement</div>
                    <div class="state-description">Récupération des alertes en cours...</div>
                </div>
            `;
        }

        function showError(errorMessage = 'Erreur inconnue') {
            document.getElementById('alerts-container').innerHTML = `
                <div class="state-container">
                    <div class="state-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="state-title">Erreur de chargement</div>
                    <div class="state-description">
                        Impossible de charger les alertes : ${errorMessage}
                    </div>
                    <button class="retry-button" onclick="fetchServiceAlerts()">
                        Réessayer
                    </button>
                </div>
            `;
        }

        function displayAlerts(alerts) {
            const alertsContainer = document.getElementById('alerts-container');
            
            if (alerts.length === 0) {
                alertsContainer.innerHTML = `
                    <div class="state-container">
                        <div class="state-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="state-title">Tout va bien !</div>
                        <div class="state-description">Aucune perturbation signalée actuellement.</div>
                    </div>
                `;
                return;
            }
            
            alertsContainer.innerHTML = '';
            
            alerts.forEach((alert, index) => {
                const alertCard = createAlertCard(alert, index);
                alertsContainer.appendChild(alertCard);
            });
        }

        function createAlertCard(alert, index) {
            const effectInfo = getEffectInfo(alert.effect);
            const causeInfo = getCauseInfo(alert.cause);
            const alertCard = document.createElement('div');
            alertCard.className = `alert-card gpu-accelerated ${effectInfo.className}`;
            alertCard.style.animationDelay = `${index * 0.08}s`;
            
            const formatTime = (date) => {
                if (!date) return null;
                return date.toLocaleString('fr-FR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };
            
            const timeRanges = alert.activePeriods.map(period => {
                if (period.start && period.end) {
                    return `Du ${formatTime(period.start)} au ${formatTime(period.end)}`;
                } else if (period.start) {
                    return `Depuis le ${formatTime(period.start)}`;
                } else if (period.end) {
                    return `Jusqu'au ${formatTime(period.end)}`;
                }
                return null;
            }).filter(Boolean);

            const affectedInfo = getAffectedEntitiesInfo(alert.affectedEntities);

            alertCard.innerHTML = `
                <div class="alert-header">
                    <div class="alert-icon">
                        <i class="${effectInfo.icon}"></i>
                    </div>
                    <div class="alert-details">
                        <div class="alert-type">${effectInfo.label}</div>
                        <div class="alert-title">${escapeHtml(alert.header)}</div>
                        <div class="alert-timestamp">
                            <i class="fas fa-clock"></i>
                            ${formatTime(alert.timestamp)}
                        </div>
                    </div>
                </div>
                <div class="alert-content">
                    ${alert.description ? `
                        <div class="alert-description">
                            ${escapeHtml(alert.description)}
                        </div>
                    ` : ''}
                    <div class="alert-metadata">
                        ${causeInfo.label !== 'Non spécifiée' ? `
                            <div class="alert-metadata-item">
                                <i class="${causeInfo.icon}"></i>
                                <span>Cause : ${causeInfo.label}</span>
                            </div>
                        ` : ''}
                        ${timeRanges.length > 0 ? `
                            <div class="alert-metadata-item">
                                <i class="fas fa-calendar-alt"></i>
                                <span>${timeRanges[0]}</span>
                            </div>
                        ` : ''}
                        ${affectedInfo ? `
                            <div class="alert-metadata-item">
                                <i class="fas fa-route"></i>
                                <span>${affectedInfo}</span>
                            </div>
                        ` : ''}
                        ${alert.url ? `
                            <div class="alert-metadata-item">
                                <i class="fas fa-external-link-alt"></i>
                                <a href="${alert.url}" target="_blank" rel="noopener noreferrer">Plus d'informations</a>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            return alertCard;
        }

        function getEffectInfo(effect) {
            const effects = {
                'NO_SERVICE': { 
                    icon: 'fas fa-ban', 
                    label: 'Service interrompu', 
                    className: 'alert-accident',
                    priority: 5 
                },
                'REDUCED_SERVICE': { 
                    icon: 'fas fa-arrow-down', 
                    label: 'Service réduit', 
                    className: 'alert-service-reduit',
                    priority: 3 
                },
                'SIGNIFICANT_DELAYS': { 
                    icon: 'fas fa-clock', 
                    label: 'Retards importants', 
                    className: 'alert-service-modifie',
                    priority: 3 
                },
                'DETOUR': { 
                    icon: 'fas fa-route', 
                    label: 'Déviation', 
                    className: 'alert-service-modifie',
                    priority: 2 
                },
                'ADDITIONAL_SERVICE': { 
                    icon: 'fas fa-plus', 
                    label: 'Service supplémentaire', 
                    className: 'alert-information',
                    priority: 1 
                },
                'MODIFIED_SERVICE': { 
                    icon: 'fas fa-exclamation-triangle', 
                    label: 'Service modifié', 
                    className: 'alert-service-modifie',
                    priority: 3 
                },
                'OTHER_EFFECT': { 
                    icon: 'fas fa-info-circle', 
                    label: 'Autre perturbation', 
                    className: 'alert-information',
                    priority: 2 
                },
                'UNKNOWN_EFFECT': { 
                    icon: 'fas fa-question-circle', 
                    label: 'Perturbation', 
                    className: 'alert-information',
                    priority: 1 
                },
                'STOP_MOVED': { 
                    icon: 'fas fa-map-marker-alt', 
                    label: 'Arrêt déplacé', 
                    className: 'alert-service-modifie',
                    priority: 2 
                },
                'NO_EFFECT': { 
                    icon: 'fas fa-info', 
                    label: 'Information', 
                    className: 'alert-information',
                    priority: 1 
                },
                'ACCESSIBILITY_ISSUE': { 
                    icon: 'fas fa-wheelchair', 
                    label: 'Problème d\'accessibilité', 
                    className: 'alert-service-modifie',
                    priority: 3 
                }
            };
            
            return effects[effect] || effects['UNKNOWN_EFFECT'];
        }

        function getCauseInfo(cause) {
            const causes = {
                'TECHNICAL_PROBLEM': { 
                    label: 'Problème technique', 
                    icon: 'fas fa-cogs' 
                },
                'STRIKE': { 
                    label: 'Grève', 
                    icon: 'fas fa-fist-raised' 
                },
                'DEMONSTRATION': { 
                    label: 'Manifestation', 
                    icon: 'fas fa-bullhorn' 
                },
                'ACCIDENT': { 
                    label: 'Accident', 
                    icon: 'fas fa-ambulance' 
                },
                'HOLIDAY': { 
                    label: 'Jour férié', 
                    icon: 'fas fa-calendar-day' 
                },
                'WEATHER': { 
                    label: 'Conditions météo', 
                    icon: 'fas fa-cloud-rain' 
                },
                'MAINTENANCE': { 
                    label: 'Maintenance', 
                    icon: 'fas fa-tools' 
                },
                'CONSTRUCTION': { 
                    label: 'Travaux', 
                    icon: 'fas fa-hard-hat' 
                },
                'POLICE_ACTIVITY': { 
                    label: 'Intervention police', 
                    icon: 'fas fa-shield-alt' 
                },
                'MEDICAL_EMERGENCY': { 
                    label: 'Urgence médicale', 
                    icon: 'fas fa-user-md' 
                },
                'OTHER_CAUSE': { 
                    label: 'Autre cause', 
                    icon: 'fas fa-question' 
                },
                'UNKNOWN_CAUSE': { 
                    label: 'Non spécifiée', 
                    icon: 'fas fa-question-circle' 
                }
            };
            
            return causes[cause] || causes['UNKNOWN_CAUSE'];
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
        }

        function getAffectedEntitiesInfo(entities) {
            if (!entities || entities.length === 0) return null;
            
            const routes = entities.filter(e => e.routeId).map(e => e.routeId);
            const stops = entities.filter(e => e.stopId).map(e => e.stopId);
            
            const parts = [];
            if (routes.length > 0) {
                parts.push(`Lignes : ${routes.slice(0, 3).join(', ')}${routes.length > 3 ? '...' : ''}`);
            }
            if (stops.length > 0) {
                parts.push(`Arrêts : ${stops.slice(0, 2).join(', ')}${stops.length > 2 ? '...' : ''}`);
            }
            
            return parts.join(' · ') || null;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function initEventListeners() {
            const refreshBtn = document.getElementById('refresh-button');
            refreshBtn.addEventListener('click', () => {
                refreshBtn.classList.add('spinning');
                clearTimeout(refreshTimer);
                fetchServiceAlerts();
                setTimeout(() => {
                    refreshBtn.classList.remove('spinning');
                }, 800);
            });
            
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.addEventListener('click', (e) => {
                    document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    
                    currentFilter = e.currentTarget.dataset.effect;
                    filterAlerts();
                    
                    if ('vibrate' in navigator) {
                        navigator.vibrate(10);
                    }
                });
            });
            
            let searchTimeout;
            document.getElementById('search-input').addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    searchAlerts(e.target.value);
                }, 300);
            });
        }

        function filterAlerts() {
            let filteredAlerts = currentAlerts;
            
            if (currentFilter !== 'all') {
                const filterEffect = normalizeEffect(parseInt(currentFilter));
                filteredAlerts = currentAlerts.filter(alert => alert.effect === filterEffect);
            }
            
            displayAlerts(filteredAlerts);
        }

        function searchAlerts(searchTerm) {
            const term = searchTerm.toLowerCase().trim();
            
            if (!term) {
                filterAlerts();
                return;
            }
            
            let filteredAlerts = currentAlerts.filter(alert => {
                return alert.header.toLowerCase().includes(term) ||
                    alert.description.toLowerCase().includes(term) ||
                    (alert.affectedEntities && alert.affectedEntities.some(entity => 
                        (entity.routeId && entity.routeId.toLowerCase().includes(term)) ||
                        (entity.stopId && entity.stopId.toLowerCase().includes(term))
                    ));
            });
            
            if (currentFilter !== 'all') {
                const filterEffect = normalizeEffect(parseInt(currentFilter));
                filteredAlerts = filteredAlerts.filter(alert => alert.effect === filterEffect);
            }
            
            displayAlerts(filteredAlerts);
        }

        function initBackToTop() {
            const backToTop = document.getElementById('back-to-top');
            
            let ticking = false;
            window.addEventListener('scroll', () => {
                if (!ticking) {
                    requestAnimationFrame(() => {
                        if (window.scrollY > 400) {
                            backToTop.classList.add('visible');
                        } else {
                            backToTop.classList.remove('visible');
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
            
            backToTop.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
                
                if ('vibrate' in navigator) {
                    navigator.vibrate(15);
                }
            });
        }

        function initScrollEffects() {
            const header = document.querySelector('.header');
            
            let lastScroll = 0;
            let ticking = false;
            
            window.addEventListener('scroll', () => {
                if (!ticking) {
                    requestAnimationFrame(() => {
                        const currentScroll = window.scrollY;
                        
                        if (currentScroll > 50) {
                            header.classList.add('scrolled');
                        } else {
                            header.classList.remove('scrolled');
                        }
                        
                        lastScroll = currentScroll;
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        }

        function getSeverityInfo(severity) {
            const severities = {
                'INFO': { label: 'Information', priority: 1 },
                'WARNING': { label: 'Attention', priority: 2 },
                'SEVERE': { label: 'Grave', priority: 3 },
                'UNKNOWN': { label: 'Non spécifié', priority: 0 }
            };
            
            return severities[severity] || severities['UNKNOWN'];
        }

        function sortAlertsByPriority(alerts) {
            return alerts.sort((a, b) => {
                const effectA = getEffectInfo(a.effect);
                const effectB = getEffectInfo(b.effect);
                
                if (effectA.priority !== effectB.priority) {
                    return effectB.priority - effectA.priority;
                }
                
                const severityA = getSeverityInfo(a.severity).priority;
                const severityB = getSeverityInfo(b.severity).priority;
                
                if (severityA !== severityB) {
                    return severityB - severityA;
                }
                
                const timeA = (a.activePeriods[0] && a.activePeriods[0].start) || a.timestamp;
                const timeB = (b.activePeriods[0] && b.activePeriods[0].start) || b.timestamp;
                
                return timeB - timeA;
            });
        }

        window.addEventListener('beforeunload', () => {
            if (refreshTimer) {
                clearTimeout(refreshTimer);
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const searchInput = document.getElementById('search-input');
                if (searchInput.value) {
                    searchInput.value = '';
                    searchInput.blur();
                    filterAlerts();
                }
            }
            
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                document.getElementById('refresh-button').click();
            }
        });

        window.addEventListener('load', () => {
            document.body.style.opacity = '0';
            requestAnimationFrame(() => {
                document.body.style.transition = 'opacity 0.4s ease';
                document.body.style.opacity = '1';
            });
        });

        let touchStartY = 0;
        let touchEndY = 0;
        
        document.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
        }, { passive: true });
        
        document.addEventListener('touchmove', (e) => {
            touchEndY = e.touches[0].clientY;
        }, { passive: true });
        
        document.addEventListener('touchend', () => {
            if (window.scrollY === 0 && touchEndY > touchStartY + 100) {
                fetchServiceAlerts();
                
                if ('vibrate' in navigator) {
                    navigator.vibrate(20);
                }
            }
        }, { passive: true });
    </script>
</body>
</html>
